### 08 | 调用栈：为什么JavaScript代码会出现栈溢出？

- 执行上下文
    1. 当 JavaScript 执行全局代码的时候，会编译全局代码并创建全局执行上下文，而且在整个页面的生存周期内，全局执行上下文只有一份。
    2. 当调用一个函数的时候，函数体内的代码会被编译，并创建函数执行上下文，一般情况下，函数执行结束之后，创建的函数执行上下文会被销毁。
    3. 当使用 eval 函数的时候，eval 的代码也会被编译，并创建执行上下文。

# 什么是函数调用
  **调用栈就是用来管理函数调用关系的一种数据结构。**
```js
var a = 2
function add(){
var b = 10
return  a+b
}
add()
```
执行操作:
1. 首先，从全局执行上下文中，取出 add 函数代码。
2. 其次，对 add 函数的这段代码进行编译，并创建该函数的执行上下文和可执行代码。
3. 最后，执行代码，输出结果。

- 存在多个执行上下文，那么 JavaScript 引擎是如何管理这些执行上下文的呢？
    通过一种叫**栈**的数据结构来管理的。

# 什么是 JavaScript 的调用栈
JavaScript 引擎会将执行上下文压入栈中, 用来管理执行上下文的栈称为执行上下文栈，又称调用栈。
```js
var a = 2
function add(b,c){
  return b+c
}
function addAll(b,c){
var d = 10
result = add(b,c)
return  a+result+d
}
addAll(3,6)
```
1. 创建全局上下文，并将其压入栈底。
2. 调用 addAll 函数。为其创建一个执行上下文，最后还将该函数的执行上下文压入栈中
3. 当执行到 add 函数。 同样会为其创建执行上下文，并将其压入调用栈
4. 当 add 函数返回时，该函数的执行上下文就会从栈顶弹出，并将 result 的值设置为 add 函数的返回值
5. addAll 执行最后一个相加操作后并返回，addAll 的执行上下文也会从栈顶部弹出，此时调用栈中就只剩下全局上下文了
*调用栈是 JavaScript 引擎追踪函数执行的一个机制*

# 在开发中，如何利用好调用栈
- 如何利用浏览器查看调用栈的信息
    1. 你可以打开“开发者工具”，点击“Source”标签，选择 JavaScript 代码的页面，然后在第 3 行加上断点，并刷新页面。你可以看到执行到 add 函数时，执行流程就暂停了，这时可以通过右边“call stack”来查看当前的调用栈的情况
    2. 使用 console.trace() 来输出当前的函数调用关系
- 栈溢出（Stack Overflow）
**调用栈是有大小的**，当入栈的执行上下文超过一定数目

## 总结
1. 每调用一个函数，JavaScript 引擎会为其创建执行上下文，并把该执行上下文压入调用栈，然后 JavaScript 引擎开始执行函数代码。
2. 如果在一个函数 A 中调用了另外一个函数 B，那么 JavaScript 引擎会为 B 函数创建执行上下文，并将 B 函数的执行上下文压入栈顶。
3. 当前函数执行完毕后，JavaScript 引擎会将该函数的执行上下文弹出栈。
4. 当分配的调用栈空间被占满时，会引发“堆栈溢出”问题。